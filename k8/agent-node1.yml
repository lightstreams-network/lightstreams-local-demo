apiVersion: v1
kind: Pod
metadata:
  name: agent-node1
  labels:
    app: agent-node1
spec:
  volumes:
  - name: node1
    hostPath:
      path: /mnt/deploy/node1
      type: Directory
  containers:
  - name: agent-container1
    image: lightstreams/leth-0.33.0-alpha-demo:latest
    imagePullPolicy: Never 
    volumeMounts:
      - name: node1
        mountPath: /srv/lightchain
    env:
      - name: AGENT_HOME
        value: "/root/.lightstreams_1"
    ports:
      - containerPort: 4002
      - containerPort: 9091
    command:
      - bash
      - "-c"
      - |

        if [ ! -f $AGENT_HOME/config.json ]; then
          leth init --nodeid=1 --network=sirius --lightclient=true --federation=false --demo=true --blockchain_url=http://$VALIDATOR_ETH1_PORT_8545_TCP_ADDR:8545 || exit 1
          mkdir -p $AGENT_HOME/sirius/database/keystore
          
          cp -r /srv/lightchain/config/UTC--2024-03-31T14-44-22.154522000Z--c69e5c2570db605a9c55dd7f513e23325ad8a8e1 $AGENT_HOME/sirius/database/keystore
          cp -r /srv/lightchain/config/UTC--2019-01-16T08-35-20.225Z--61f3b85929c20980176d4a09771284625685c40e $AGENT_HOME/sirius/database/keystore
        
          cp -r /srv/lightchain/ipfs.config $AGENT_HOME/ipfs/config
          
        fi

        leth run --nodeid=1 --network=sirius --https

        tail -f /dev/null
